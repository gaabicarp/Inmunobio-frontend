<div class="m-4" routerLink="../../" role="button">
  <h5><span><i class="bi bi-arrow-left"></i></span>VOLVER</h5>
</div>



<div class="mx-4">
  <div class="my-3">
    <div class="d-flex align-items-center">
      <h2 class="mb-0">Experimento - {{experimento?.codigo}}</h2>
      <div class="ml-4" *ngIf='!experimento?.finalizado'>
        <button class="btn btn-outline-primary" style="cursor: pointer" routerLink='../../editar-experimento/{{idExperimento}}'><i class="bi bi-pencil text-primary"></i> Editar</button>
        <button class="btn btn-outline-danger ml-4" (click)="open(finalizarExperimento)">Finalizar Experimento</button>
      </div>
    </div>
  </div>

    <ul ngbNav #nav="ngbNav" class="nav-tabs">
        <li [ngbNavItem]="1">
            <a ngbNavLink>Detalles</a>
            <ng-template ngbNavContent>
              <div class="mx-4">
                <div class="p-4">
                  <h4 class="text-secondary text-staatliches mb-0">Objetivo del Experimento</h4>
                  <p>{{experimento?.objetivos}}</p>
                  <h4 class="text-secondary text-staatliches mb-0">Resultados del Experimento</h4>
                  <p class="text-danger"><i>{{experimento?.resultados ? experimento?.resultados : 'Experimento Sin Finalizar'}}</i></p>
                  <h4 class="text-secondary text-staatliches mb-0">Conclusiones del Experimento</h4>
                  <p class="text-danger"><i>{{experimento?.conclusiones ? experimento?.conclusiones : 'Experimento Sin Finalizar'}}</i></p>
                </div>
                <div class="rounded p-5 d-flex align-items-center justify-content-around">
                  <div class="mx-5">
                    <h4 class="text-secondary text-staatliches mb-0">Fecha de Inicio</h4>
                    <p class="mb-0">{{experimento?.fechaInicio | date}}</p>
                  </div>
                  <div class="barra"></div>
                  <div class="mx-5">
                    <h4 class="text-secondary text-staatliches mb-0">Fecha de Finalizacion</h4>
                    <p class="mb-0 {{proyecto?.fechaFinal ? 'text-danger' : ''}}">{{experimento?.fechaFinal ? (experimento?.fechaFinal | date) : 'Sin finalizar'}}</p>
                  </div>
                  <div class="barra"></div>
                  <div class="mx-5">
                    <h4 class="text-secondary text-staatliches mb-0">Metodologia de Trabajo</h4>
                    <a href='{{experimento?.metodologia}}' target="_blank" class="mb-0">{{experimento?.metodologia}}</a>  
                  </div>
                </div>
              </div>
              <div class="mx-5">
                <div class="d-flex align-items-center">
                  <h4 class="text-secondary text-staatliches mb-0">Grupos Experimentales</h4>
                  <div class="ml-4">
                    <button class="btn btn-outline-primary" style="cursor: pointer" (click)="open(GrupoExperimental)">+ Nuevo</button>
                  </div>
                </div>
                <div class="cards-container">
                  <div *ngFor="let grupo of gruposExperimentales" class="card card-experimento my-3 mx-4 p-4 shadow rounded list-group-item-action" routerLink='grupo-experimental/{{grupo.id_grupoExperimental}}'>
                    <div class="">
                      <div class="card-body">
                          <h5 class="card-title text-center">{{grupo.codigo}}</h5>
                          <hr class="my-3 bg-{{experimento.habilitado? 'danger' : 'success'}}">
                          <p class="card-text text-center">{{grupo.descripcion?.substring(0,100)}}{{grupo.descripcion?.length > 100 ? '...' : ''}}</p>
                          <div class="d-flex flex-row justify-content-between">
                              <div>
                                  <h6><i>Cantidad de Fuentes</i></h6>
                                  <p class="mb-0">{{grupo.fuentesExperimentales.length}}</p>
                              </div>
                              <div>
                                  <h6><i>Cantidad de Muestras</i></h6>
                                  <p class="mb-0">{{grupo.muestras.length}}</p>
                              </div>
                          </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="my-3" *ngIf='gruposExperimentales.length === 0'>
                  <p class="text-danger"><i>No hay grupos experimentales creados</i></p>
                </div>
              </div>

                


            </ng-template>
        </li>
        <li [ngbNavItem]="2">
            <a ngbNavLink>Blog</a>
            <ng-template ngbNavContent>
              <div class="m-4">
                <div class="">
                  <form class="row">
                    <div class="col-3 d-flex justify-content-center" *ngIf='!experimento?.finalizado'>
                      <button class="btn btn-outline-success" (click)="open(blog)">Nueva Entrada</button>
                    </div>
                    <div class="barra" *ngIf='!experimento?.finalizado'></div>
                    <div class="col-6 d-flex justify-content-around align-items-center">
                      <div class="form-group mb-0">
                        <div class="input-group">
                          <input class="form-control" placeholder="Fecha Desde"
                                 name="dp" [(ngModel)]="fechaDesde" max="fechaHasta" ngbDatepicker #d="ngbDatepicker">
                          <div class="input-group-append">
                            <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button"><i class="bi bi-calendar"></i></button>
                          </div>
                        </div>
                      </div>
                      <div class="form-group mb-0">
                        <div class="input-group">
                          <input class="form-control" placeholder="Fecha Hasta"
                                 name="dp" [(ngModel)]="fechaHasta" ngbDatepicker min="fechaDesde" #b="ngbDatepicker">
                          <div class="input-group-append">
                            <button class="btn btn-outline-secondary calendar" (click)="b.toggle()" type="button"><i class="bi bi-calendar"></i></button>
                          </div>
                        </div>
                      </div>
                      <button class="btn btn-outline-secondary" (click)='filtrarBlogs()'>Filtrar</button>
                    </div>
                    
                  </form>
                </div>
                
                <div class="p-4 d-flex flex-column">

                  <div class="my-3" *ngIf='blogs.length === 0'>
                    <p class="text-danger"><i>No hay blogs creados</i></p>
                  </div>

                  <ngb-alert [dismissible]="false" class="w-75" *ngFor='let blog of blogs'>
                    <div class="row" >
                      <div class="col-3 d-flex flex-column justify-content-center align-items-center">
                        <div class="rounded-circle border border-dark d-flex justify-content-center align-items-center m-auto" style="width: 35px; height: 35px;">
                          <i class="bi bi-arrow-left-right"></i>
                        </div>
                        <p class="text-center mb-0">{{blog.fecha | date:'short' }}</p>
                      </div>
                      <div class="col-9">
                        <strong>{{blog.tipo}} - {{blog?.codigoExperimento}}</strong> 
                        <p class="mb-0"><i>{{blog.id_usuario}}</i></p>
                        <p>{{blog.detalle}}</p>
                      </div>
                    </div>
                  </ngb-alert>
              
                  <!-- <button class="btn btn-outline-primary text-center">Ver mas</button> -->
                </div>
              </div>
              <div class="alert alert-danger text-center" role="alert" *ngIf='blogs.length === 0 '>
                No existen blogs
              </div> 
            </ng-template>
        </li>
    </ul>
    <div [ngbNavOutlet]="nav" class="mt-2"></div>
</div>

<ng-template #GrupoExperimental let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Crear Grupo Experimental</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body mx-5">
    <div class="row">
      <form [formGroup]='formGrupoExperimental' class="col-8">
        <div class="form-group">
          <label for="otro" class="form-label">Codigo de grupo experimental</label>
          <input type="text" class="form-control" id="otro" formControlName='codigo'>
        </div>
        <div class="form-group">
          <label for="tipo" class="form-label">Tipo</label>
          <select class="form-control"  id='tipo' aria-label="Default select example" formControlName='tipo'>
                  <option value="animal">Animal</option>
                  <option value="otro">Otro</option>
          </select>
        </div>
        <div class="form-group">
          <label for="tipo" class="form-label">Descripcion</label>
          <textarea class="form-control" id='descripcion' aria-label="With textarea" rows="6" formControlName='descripcion'></textarea>
        </div>
      </form>
      <div class="col-4 d-flex justify-content-center align-items-center">
        <i class="bi bi-diagram-3" style="font-size: 8em;"></i>
      </div>
    </div>
  </div>
  <div class="modal-footer">
      <button class="btn btn-outline-primary btn-lg mr-3" (click)='crearGrupoExperimental()'>Crear</button>
  </div>
</ng-template>

<ng-template #blog let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Crear Publicacion</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body mx-5">
    <div class="row">
      <div class="col-8 form-group">
        <label for="tipo" class="form-label">Escriba una publicacion</label>
        <textarea class="form-control" id='descripcion' aria-label="With textarea" rows="6" [(ngModel)]='detalleExperimento'></textarea>
      </div>
      <div class="col d-flex justify-content-center align-items-center">
        <i class="bi bi-file-earmark-text" style="font-size: 8em;"></i>
      </div>
    </div>
  </div>
  <div class="modal-footer">
      <button class="btn btn-outline-primary btn-lg mr-3" (click)='crearBlog()'>Crear</button>
  </div>
</ng-template>

<ng-template #finalizarExperimento let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Finalizar Proyecto</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <app-finalizar-experimento (cerrar)="modal.dismiss()"></app-finalizar-experimento>
  </div>
  <!-- <div class="modal-footer">
      <button class="btn btn-primary mr-3"(propagar)="procesaPropagar($event)">Agregar</button>
  </div> -->
</ng-template>


<app-toast></app-toast>